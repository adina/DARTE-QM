---
title: "Sequencing Results"
author: <a href="https://schuyler-smith.github.io/" target="_blank" >Schuyler D. Smith</a>
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---
<br>
<br>

```{r setup, message=FALSE, warning=FALSE, echo=FALSE}
sample_seq_results <- fread('../data/sample_seq_results.csv')
```


## Mock-Community {.tabset .tabset-pills}
```{r mock, message=FALSE, warning=FALSE, echo=FALSE}
mock_qual <- readRDS('../data/seq_qual/mock_qual.RDS')
graph_data <- mock_qual[[1]]
stat_data <- mock_qual[[2]]
annotations <- mock_qual[[3]]
```

### MiSeq Quality scores {.tabset .tabset-pills}
```{r, mock_qual, results='asis', echo=FALSE, fig.width=12, fig.height=5, cache=TRUE}
n=1
for (i in grep("_R1_", annotations$file)){
  cat("####", n, '<br>', '\n\n')
  print(plot_sequence_quality(list(
  	graph_data[file %in% annotations$file[c(i,i+1)]],
  	stat_data[file %in% annotations$file[c(i,i+1)]],
  	annotations[file %in% annotations$file[c(i,i+1)]])))
  cat('\n', '<br>', '\n\n')
  n=n+1
}

```
<br>
<br>

### Sequence Results
```{r mock_res, message=FALSE, warning=FALSE, echo=FALSE}
datatable(sample_seq_results[Sample %in% sample_seq_results$Sample[grep('Mock', sample_seq_results$Sample)]])
```
<br>
<br>


## Soil Column I {.tabset .tabset-pills}
```{r sci, message=FALSE, warning=FALSE, echo=FALSE}
sci_qual <- readRDS('../data/seq_qual/sci_qual.RDS')
graph_data <- sci_qual[[1]]
stat_data <- sci_qual[[2]]
annotations <- sci_qual[[3]]
```

### MiSeq Quality scores {.tabset .tabset-pills}
```{r, sci_qual, results='asis', echo=FALSE, fig.width=12, fig.height=5, cache=TRUE}
n=1
for (i in grep("_R1_", annotations$file)){
  cat("####", n, '<br>', '\n\n')
  print(plot_sequence_quality(list(
  	graph_data[file %in% annotations$file[c(i,i+1)]],
  	stat_data[file %in% annotations$file[c(i,i+1)]],
  	annotations[file %in% annotations$file[c(i,i+1)]])))
  cat('\n', '<br>', '\n\n')
  n=n+1
}

```
<br>
<br>

### Sequence Results
```{r sci_res, message=FALSE, warning=FALSE, echo=FALSE}
datatable(sample_seq_results[Sample %in% sample_seq_results$Sample[grep('SCI_', sample_seq_results$Sample)]])
```
<br>
<br>


## Soil Column II {.tabset .tabset-pills}
```{r scii, message=FALSE, warning=FALSE, echo=FALSE}
scii_qual <- readRDS('../data/seq_qual/scii_qual.RDS')
graph_data <- scii_qual[[1]]
stat_data <- scii_qual[[2]]
annotations <- scii_qual[[3]]
```

### MiSeq Quality scores {.tabset .tabset-pills}
```{r, scii_qual, results='asis', echo=FALSE, fig.width=12, fig.height=5, cache=TRUE}
n=1
for (i in grep("_R1_", annotations$file)){
  cat("####", n, '<br>', '\n\n')
  print(plot_sequence_quality(list(
  	graph_data[file %in% annotations$file[c(i,i+1)]],
  	stat_data[file %in% annotations$file[c(i,i+1)]],
  	annotations[file %in% annotations$file[c(i,i+1)]])))
  cat('\n', '<br>', '\n\n')
  n=n+1
}

```
<br>
<br>

### Sequence Results
```{r scii_res, message=FALSE, warning=FALSE, echo=FALSE}
datatable(sample_seq_results[Sample %in% sample_seq_results$Sample[grep('SCII_', sample_seq_results$Sample)]])
```
<br>
<br>


## Swine Fecal {.tabset .tabset-pills}
```{r fecal, message=FALSE, warning=FALSE, echo=FALSE}
fecal_qual <- readRDS('../data/seq_qual/fecal_qual.RDS')
graph_data <- fecal_qual[[1]]
stat_data <- fecal_qual[[2]]
annotations <- fecal_qual[[3]]
```

### MiSeq Quality scores {.tabset .tabset-pills}
```{r, fecal_qual, results='asis', echo=FALSE, fig.width=12, fig.height=5, cache=TRUE}
n=1
for (i in grep("_R1_", annotations$file)){
  cat("####", n, '<br>', '\n\n')
  print(plot_sequence_quality(list(
  	graph_data[file %in% annotations$file[c(i,i+1)]],
  	stat_data[file %in% annotations$file[c(i,i+1)]],
  	annotations[file %in% annotations$file[c(i,i+1)]])))
  cat('\n', '<br>', '\n\n')
  n=n+1
}

```
<br>
<br>

### Sequence Results
```{r fecal_res, message=FALSE, warning=FALSE, echo=FALSE}
datatable(sample_seq_results[Sample %in% sample_seq_results$Sample[grep('X1P', sample_seq_results$Sample)]])
```


```{r, setup_seq_quals, echo=FALSE, eval=FALSE}
 file_path = '../data/raw_reads'
 files <- dir(file_path, full.names = TRUE)
 files <- normalizePath(files)
 mock_files <- files[grep('Mock', files)]
 mock_qual <- sequence_quality(mock_files)
 saveRDS(mock_qual, "../data/seq_qual/mock_qual.RDS")

 sci_files <- files[grep('SCI-', files)]
 sci_qual <- sequence_quality(sci_files)
 saveRDS(sci_qual, "../data/seq_qual/sci_qual.RDS")

 scii_files <- files[grep('SCII-', files)]
 scii_qual <- sequence_quality(scii_files)
 saveRDS(scii_qual, "../data/seq_qual/scii_qual.RDS")

 fecal_files <- files[grep('X1P', files)]
 fecal_qual <- sequence_quality(fecal_files)
 saveRDS(fecal_qual, "../data/seq_qual/fecal_qual.RDS")
```